# Redirect HTTP to HTTPS
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Remove www Prefix
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1%{REQUEST_URI} [R=301,L]

# Set CORS Header
Header set Access-Control-Allow-Origin "*"

# Exclude docs/swagger/routes/bloggable
RewriteRule ^docs(/.*)?$ - [L]
RewriteRule ^swagger(.*)?$ - [L]
RewriteRule ^routes\.php$ - [L]
RewriteRule ^bloggable\.php$ - [L]

# Rewrite /api for routes.php -> bloggable.php
RewriteRule ^api/(.*)$ routes.php?path=$1 [QSA,L]

# Pass through front-end app requests
RewriteCond %{REQUEST_URI} !^/index\.html$
RewriteCond %{REQUEST_URI} !^/routes\.php$
RewriteCond %{REQUEST_URI} !^/bloggable\.php$
RewriteCond %{REQUEST_URI} !^/swagger\.json$
RewriteRule ^(.*)$ /index.html [L]

